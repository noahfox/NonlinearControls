clear *; close all; clc

global best_yet initials
best_yet = 0;
consts = get_consts();

% States: x=[y,z,th,psi,dy,dz,dth,dpsi,m]'
fuel = consts.m_nofuel+consts.max.m_fuel;
initials = [0 170 0 0 0 0 0 0 fuel];


opts.MaxFunEvals  = 50000;
opts.TolX = 1e-6;
opts.StopFitness = 1e-6;
opts.CMA.active = 1;
opts.Restarts = 0;
opts.LogPlot = 'off';
opts.StopOnStagnation = 'on';
opts = cmaes('defaults', opts);

% sigma = [.001 .001 10 .001 .001 .001 1 .001 0.001 0.1 0.1]';
% sigma = 0.1;
sigma = [.2 .4 .03 .01 1.3 2.3 .01 .01 .01 .01 .01 12 24 .4 .01 16 10 .01]';

% x0 = [0.001 0.001 100 0.001 0.001 0.001 10 0.001 0.001 .5 2.0...
%       0.1 100 10 0.000001 0.001 0.001 .001 0.001 0.001 .1 10];
% x0 = [ -0.7544 1.1544 0 0 -5.5728 8.5728 0 0 -0.1575];
K_top = [-0.684995189331813,1.15059724593106,-0.102287336164053,0.0697255362865406,-5.61834282543692,8.46906736340270,-0.0865564201780617,-0.00516796088993788,-0.150346777975641];
x0 = [K_top,[ 0.1306    0  -37.6338   72.8933    1.6009    0  -48.6607   30.3236    0]];

% x0 = [-0.817773334725316,1.42264844661332,-0.150966700605397,0.0931472512821984,-6.39116125444814,12.7411142681841,-0.0846091756820005,-0.0135195824539072,-0.149744777853143,0.144986114030858,0.00489474158082315,-28.4321973792661,85.3079411539528,1.21461743399794,-0.0173863259124559,-60.0298845197917,38.8919411926537,-0.00233255524517929];

[XMIN,FMIN,COUNTEVAL,STOPFLAG,OUT,BESTEVER] = cmaes('costfun',x0,sigma,opts);
